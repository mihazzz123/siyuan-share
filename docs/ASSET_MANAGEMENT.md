# Управление статическими ресурсами

## Обзор функций

Функция управления статическими ресурсами позволяет пользователям просматривать, фильтровать и управлять всеми файлами (изображениями, видео, аудио, вложениями), которые были загружены в S3 через плагин.

## Основные возможности

### 1. Представление списка ресурсов

- **Единый интерфейс**: доступ к разделу «Управление ресурсами» через настройки плагина.
- **Статистика**: отображение общего количества и суммарного объема ресурсов.
- **Список в виде карточек**: каждый ресурс представлен карточкой, содержащей:
  - Имя файла
  - Размер файла
  - Документ, к которому относится ресурс
  - Время загрузки
  - Ключ объекта в S3 (S3 Storage Key)
  - Миниатюра предпросмотра (для изображений)

### 2. Функции фильтрации

#### Поиск по имени файла
- Поле поиска в верхней части экрана.
- Фильтрация соответствующих ресурсов в реальном времени.
- Поддержка нечеткого поиска (частичное совпадение).

#### Фильтр по документам
- Выпадающий список для выбора конкретной заметки.
- Отображение только тех ресурсов, которые связаны с выбранным документом.
- Список документов отсортирован по заголовкам.

#### Сброс фильтров
- Кнопка для мгновенной очистки всех условий поиска.
- Возврат к отображению полного списка ресурсов.

### 3. Операции с ресурсами

Для каждой карточки ресурса доступны следующие действия:

- **Предпросмотр**: 
  - Изображения: просмотр в увеличенном масштабе в модальном окне.
  - Видео: воспроизведение во встроенном плеере.
  - Аудио: воспроизведение во встроенном плеере.
  - Другие файлы: открытие в браузере.

- **Копирование ссылки**: копирование URL-адреса доступа S3 в буфер обмена.

- **Открыть в браузере**: открытие ресурса в новой вкладке браузера.

### 4. Отображение информации о ресурсе

Каждая карточка содержит:

- **Превью**:
  - Изображения: миниатюра 80x80.
  - Другие файлы: иконка типа файла.

- **Метаданные**:
  - Имя файла (с подсказкой Tooltip).
  - Размер файла (автоматическая конвертация единиц).
  - Название связанного документа.
  - Дата и время загрузки.
  - Ключ объекта в S3 (с подсказкой Tooltip).

### 5. Распознавание типов файлов

Тип файла и соответствующая иконка определяются автоматически по MIME-типу:

- Изображения: `iconImage`
- Видео: `iconVideo`
- Аудио: `iconRecord`
- PDF: `iconPDF`
- Архивы: `iconZip`
- Текст: `iconFile`
- Прочее: `iconFile`

## Сценарии использования

### Сценарий 1: Просмотр всех загруженных ресурсов

1. Откройте настройки плагина.
2. Нажмите кнопку «Управление статическими ресурсами».
3. Просмотрите список всех файлов.

### Сценарий 2: Поиск конкретного файла

1. Введите ключевые слова в поле поиска.
2. Список будет отфильтрован мгновенно.

### Сценарий 3: Просмотр ресурсов определенного документа

1. Выберите нужный документ в выпадающем списке «Фильтр по документам».
2. В списке останутся только ресурсы этой заметки.

### Сценарий 4: Предпросмотр ресурса

1. Нажмите кнопку «Предпросмотр» на карточке ресурса.
2. Изображения/видео/аудио откроются в диалоговом окне.
3. Другие типы файлов откроются в новой вкладке браузера.

### Сценарий 5: Копирование ссылки на ресурс

1. Нажмите кнопку «Копировать ссылку».
2. S3 URL будет скопирован в буфер обмена.
3. Ссылку можно использовать в других местах.

## Техническая реализация

### Источники данных

- `AssetRecordManager`: управление записями сопоставления ресурсов.
- `ShareRecordManager`: получение информации о заголовках документов.

### Основные компоненты

- `AssetListView`: главный компонент представления списка ресурсов.
- Расположение: `src/components/asset-list-view.ts`.

### Ключевые функции

1. **Загрузка ресурсов**: получение всех сопоставлений из `AssetRecordManager`.
2. **Логика фильтрации**: 
   - По имени: поиск подстроки (без учета регистра).
   - По документу: точное совпадение `docId`.
3. **Предпросмотр**: выбор способа отображения на основе MIME-типа.
4. **Форматирование размера**: автоматическое преобразование в B/KB/MB/GB/TB.

### Локализация

Полная поддержка русского (ru_RU), английского (en_US) и китайского (zh_CN) языков:

- Тексты интерфейса
- Подсказки
- Сообщения об ошибках
- Названия кнопок

## Примечания

1. **Требование S3**: данные появятся только в том случае, если в настройках включено и настроено S3-хранилище.
2. **Права доступа**: доступ к ресурсам определяется правами доступа (ACL), настроенными в бакете S3.
3. **Управление кэшем**: записи хранятся локально; при необходимости используйте обновление данных.

## Будущие улучшения

1. Пакетное удаление ресурсов.
2. Графики статистики ресурсов.
3. Сортировка по размеру/времени.
4. Экспорт реестра ресурсов.
5. Анализ используемого дискового пространства.
6. Управление тегами ресурсов.
