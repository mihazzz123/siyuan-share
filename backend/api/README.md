# SiYuan Share API

Бэкенд-сервис для плагина публикации заметок SiYuan.

## Технологический стек

- **Go 1.24**
- **Gin** - Web-фреймворк
- **GORM** - ORM-библиотека
- **SQLite** - база данных

## Быстрый старт

### Установка зависимостей

```bash
go mod download
```

### Создание пользователя

При первом запуске необходимо создать пользователя и получить API Token:

```bash
go run tools/create_user.go -username testuser -email test@example.com
```

Скрипт выведет информацию о пользователе и **API Token**. Сохраните его для настройки плагина.

### Запуск сервиса

```bash
go run main.go
```

Порт по умолчанию: 8088 (может отличаться в зависимости от настроек)

### Переменные окружения

- `PORT` - порт сервиса (по умолчанию: 8088)
- `DATA_DIR` - директория с данными (по умолчанию: ./data)
- `GIN_MODE` - режим Gin (release/debug)

## API Интерфейс

### Авторизация

Все запросы, требующие авторизации, должны содержать заголовок:

```
Authorization: Bearer <API_TOKEN>
```

### Управление публикациями

#### Создание публикации

```
POST /api/share/create
```

Тело запроса:

```json
{
  "docId": "ID документа",
  "docTitle": "Заголовок",
  "content": "Контент (Markdown)",
  "requirePassword": false,
  "password": "Пароль (опционально)",
  "expireDays": 7,
  "isPublic": true
}
```

#### Список публикаций

```
GET /api/share/list
```

### Публичный доступ

#### Просмотр публикации

```
GET /s/:id?password=xxx
```

## Структура проекта

```
api/
├── main.go              # Точка входа
├── models/              # Модели данных
│   ├── database.go      # Инициализация БД
│   ├── share.go         # Модель публикации
│   └── user.go          # Модель пользователя
├── controllers/         # Контроллеры (логика)
├── middleware/          # Промежуточное ПО (авторизация, CORS)
└── routes/              # Маршрутизация
```

## Деплой

### Сборка

```bash
go build -o siyuan-share-api
```

### Запуск

```bash
./siyuan-share-api
```
